<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="saludo-section">
            <h1>{{ obtenerSaludoSegunHora() }}, Dr. {{ doctorActual?.nombre || 'Doctor' }}</h1>
            <p class="fecha-actual">{{ obtenerFechaFormateada() }} • {{ horaActual }}</p>
            @if (doctorActual?.especialidad) {
                <div class="especialidad-badge">
                    <i class="fas fa-stethoscope"></i>
                    {{ doctorActual?.especialidad }}
                </div>
            }
        </div>
        
                
    </div>

    <div class="estadisticas-grid">
        <div class="stat-card hoy">
            <div class="stat-icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.citasHoy }}</span>
                <span class="label">Citas Hoy</span>
                <span class="sublabel">{{ estadisticas.citasCompletadas }} completadas</span>
            </div>
        </div>

        <div class="stat-card pacientes">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.totalPacientes }}</span>
                <span class="label">Total Pacientes</span>
                <span class="sublabel">Registrados actualmente</span>
            </div>
        </div>
        <div class="stat-card tiempo">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.horasConsulta }}h</span>
                <span class="label">Horas Consulta</span>
                <span class="sublabel">Promedio: {{ metricasRendimiento.tiempoPromedioCita }}min</span>
            </div>
        </div>
    </div>

    <div class="contenido-principal">
        <div class="columna-izquierda">
            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-calendar-alt"></i> Citas de Hoy</h3>
                    <button (click)="verTodasLasCitas()" class="btn-ver-todas">
                        Ver todas <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="citas-lista">
                    <div *ngIf="citasHoy && citasHoy.length > 0; else sinSiguiente">
                      <div *ngFor="let cita of citasHoy" class="cita-item" [class]="'estado-' + cita.estado">
                        <div class="cita-hora">
                            <span class="hora">{{ cita.hora }}</span>
                            <span class="duracion">{{ cita.duracion }}min</span>
                        </div>
                        <div class="cita-info">
                            <div class="paciente-nombre">{{ cita.paciente }}</div>
                            <div class="consulta-tipo">{{ cita.tipo }}</div>
                        </div>
                                                <div class="cita-estado">
                                                    <span *ngIf="cita.estado === 'completada'" class="badge completada"><i class="fas fa-check"></i> Completada</span>
                                                    <span *ngIf="cita.estado === 'siguiente'" class="badge siguiente"><i class="fas fa-play"></i> Siguiente</span>
                                                    <span *ngIf="cita.estado === 'programada'" class="badge programada"><i class="fas fa-clock"></i> Programada</span>
                                                    <span *ngIf="cita.estado === 'no-show'" class="badge no-show"><i class="fas fa-user-times"></i> No Show</span>
                                                    <span *ngIf="cita.estado === 'cancelada'" class="badge cancelada"><i class="fas fa-ban"></i> Cancelada</span>
                                                </div>
                      </div>
                    </div>
                    <ng-template #sinSiguiente>
                      <div class="cita-item" style="border-style: dashed; justify-content: center;">
                        <div class="cita-info">
                          <div class="paciente-nombre">Ya no hay siguiente cita</div>
                          <div class="consulta-tipo">Pulsa "Ver todas" para ver historial de hoy</div>
                        </div>
                      </div>
                    </ng-template>
                </div>
            </div>

            <div *ngIf="showCitasModal" class="modal-overlay">
                <div class="modal-window">
                    <div class="modal-header">
                        <h4>Citas de Hoy</h4>
                        <button class="modal-close" (click)="cerrarModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="citas-todas-lista">
                            <div *ngIf="citasHoyTodas && citasHoyTodas.length > 0; else vacio">
                                <div *ngFor="let c of citasHoyTodas; let i = index" class="cita-item modal-item" [class]="'estado-' + c.estado">
                                    <div class="cita-hora">
                                        <span class="hora">{{ c.hora }}</span>
                                        <span class="duracion">{{ c.duracion }}min</span>
                                    </div>
                                    <div class="cita-info">
                                        <div class="paciente-nombre">{{ c.paciente }}</div>
                                        <div class="consulta-tipo">{{ c.tipo }}</div>
                                    </div>
                                    <div class="cita-estado">
                                        <span *ngIf="c.estado === 'completada'" class="badge completada"><i class="fas fa-check"></i> Completada</span>
                                        <span *ngIf="c.estado === 'siguiente'" class="badge siguiente"><i class="fas fa-play"></i> Siguiente</span>
                                        <span *ngIf="c.estado === 'programada'" class="badge programada"><i class="fas fa-clock"></i> Programada</span>
                                        <span *ngIf="c.estado === 'no-show'" class="badge no-show"><i class="fas fa-user-times"></i> No Show</span>
                                        <span *ngIf="c.estado === 'cancelada'" class="badge cancelada"><i class="fas fa-ban"></i> Cancelada</span>
                                    </div>
                                </div>
                            </div>
                            <ng-template #vacio>
                                <p class="texto-vacio">No hay citas para hoy.</p>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </div>

            <div class="seccion-card metricas">
                <div class="seccion-header">
                    <h3><i class="fas fa-trophy"></i> Métricas de Rendimiento</h3>
                </div>
                
                <div class="metricas-grid">
                    <div class="metrica-item">
                        <div class="metrica-valor">{{ metricasRendimiento.puntualidad }}%</div>
                        <div class="metrica-label">Puntualidad</div>
                        <div class="metrica-barra">
                            <div class="barra-progreso" [style.width.%]="metricasRendimiento.puntualidad"></div>
                        </div>
                    </div>
                    
                    <div class="metrica-item">
                        <div class="metrica-valor">{{ metricasRendimiento.satisfaccionPacientes }}%</div>
                        <div class="metrica-label">Satisfacción</div>
                        <div class="metrica-barra">
                            <div class="barra-progreso" [style.width.%]="metricasRendimiento.satisfaccionPacientes"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="columna-derecha">
            
            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-user-friends"></i> Pacientes Recientes</h3>
                    <button (click)="verTodosLosPacientes()" class="btn-ver-todas">
                        Ver todos <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="pacientes-lista">
                    @for (paciente of pacientesRecientes; track paciente.id) {
                    <div class="paciente-item">
                        <div class="paciente-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="paciente-info">
                            <div class="paciente-nombre">{{ paciente.nombre }}</div>
                            <div class="paciente-diagnostico">{{ paciente.diagnostico }}</div>
                            <div class="paciente-fecha">Última cita: {{ paciente.ultimaCita }}</div>
                        </div>
                        <div class="paciente-estado">
                            <span class="estado-badge" [class]="'estado-' + paciente.estado">
                                @switch (paciente.estado) {
                                    @case ('critico') { 
                                        <i class="fas fa-exclamation-triangle"></i> Crítico
                                    }
                                    @case ('seguimiento') { 
                                        <i class="fas fa-eye"></i> Seguimiento
                                    }
                                    @case ('control') { 
                                        <i class="fas fa-check-circle"></i> Control
                                    }
                                    @case ('nuevo') { 
                                        <i class="fas fa-star"></i> Nuevo
                                    }
                                }
                            </span>
                        </div>
                    </div>
                    }
                </div>
            </div>

            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                </div>
                
                <div class="actividades-lista">
                    @for (actividad of actividadesRecientes; track actividad.id) {
                    <div class="actividad-item">
                        <div class="actividad-icon" [class]="'tipo-' + actividad.tipo">
                            @switch (actividad.tipo) {
                                @case ('cita') { <i class="fas fa-calendar-check"></i> }
                                @case ('diagnostico') { <i class="fas fa-diagnoses"></i> }
                                @case ('tratamiento') { <i class="fas fa-pills"></i> }
                                @case ('nota') { <i class="fas fa-sticky-note"></i> }
                            }
                        </div>
                        <div class="actividad-info">
                            <div class="actividad-descripcion">{{ actividad.descripcion }}</div>
                            <div class="actividad-paciente">{{ actividad.paciente }}</div>
                            <div class="actividad-tiempo">{{ actividad.fecha }} • {{ actividad.hora }}</div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>