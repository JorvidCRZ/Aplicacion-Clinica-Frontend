<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="saludo-section">
            <h1>{{ obtenerSaludoSegunHora() }}, Dr. {{ doctorActual?.nombre || 'Doctor' }}</h1>
            <p class="fecha-actual">{{ obtenerFechaFormateada() }} • {{ horaActual }}</p>
            @if (doctorActual?.especialidad) {
                <div class="especialidad-badge">
                    <i class="fas fa-stethoscope"></i>
                    {{ doctorActual?.especialidad }}
                </div>
            }
        </div>
        
        @if (proximaCita) {
        <div class="proxima-cita-card">
            <div class="proxima-cita-header">
                <i class="fas fa-clock"></i>
                <span>Próxima Cita</span>
            </div>
            <div class="proxima-cita-info">
                <div class="hora-paciente">
                    <span class="hora">{{ proximaCita.hora }}</span>
                    <span class="paciente">{{ proximaCita.paciente }}</span>
                </div>
                <div class="tipo-consulta">{{ proximaCita.tipo }}</div>
                <button (click)="iniciarSiguienteCita()" class="btn-iniciar-cita">
                    <i class="fas fa-play"></i> Iniciar
                </button>
            </div>
        </div>
        }
    </div>

    <div class="estadisticas-grid">
        <div class="stat-card hoy">
            <div class="stat-icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.citasHoy }}</span>
                <span class="label">Citas Hoy</span>
                <span class="sublabel">{{ estadisticas.citasCompletadas }} completadas</span>
            </div>
        </div>

        <div class="stat-card pacientes">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.totalPacientes }}</span>
                <span class="label">Total Pacientes</span>
                <span class="sublabel">+{{ estadisticas.pacientesNuevos }} este mes</span>
            </div>
        </div>

        <div class="stat-card tiempo">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <span class="numero">{{ estadisticas.horasConsulta }}h</span>
                <span class="label">Horas Consulta</span>
                <span class="sublabel">Promedio: {{ metricasRendimiento.tiempoPromedioCita }}min</span>
            </div>
        </div>
    </div>

    <div class="contenido-principal">
        <div class="columna-izquierda">
            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-calendar-alt"></i> Citas de Hoy</h3>
                    <button (click)="verTodasLasCitas()" class="btn-ver-todas">
                        Ver todas <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="citas-lista">
                    @for (cita of citasHoy; track cita.id) {
                    <div class="cita-item" [class]="'estado-' + cita.estado">
                        <div class="cita-hora">
                            <span class="hora">{{ cita.hora }}</span>
                            <span class="duracion">{{ cita.duracion }}min</span>
                        </div>
                        <div class="cita-info">
                            <div class="paciente-nombre">{{ cita.paciente }}</div>
                            <div class="consulta-tipo">{{ cita.tipo }}</div>
                        </div>
                        <div class="cita-estado">
                            @switch (cita.estado) {
                                @case ('completada') {
                                    <span class="badge completada">
                                        <i class="fas fa-check"></i> Completada
                                    </span>
                                }
                                @case ('siguiente') {
                                    <span class="badge siguiente">
                                        <i class="fas fa-play"></i> Siguiente
                                    </span>
                                }
                                @case ('programada') {
                                    <span class="badge programada">
                                        <i class="fas fa-clock"></i> Programada
                                    </span>
                                }
                            }
                        </div>
                    </div>
                    }
                </div>
            </div>

            <div class="seccion-card metricas">
                <div class="seccion-header">
                    <h3><i class="fas fa-trophy"></i> Métricas de Rendimiento</h3>
                </div>
                
                <div class="metricas-grid">
                    <div class="metrica-item">
                        <div class="metrica-valor">{{ metricasRendimiento.puntualidad }}%</div>
                        <div class="metrica-label">Puntualidad</div>
                        <div class="metrica-barra">
                            <div class="barra-progreso" [style.width.%]="metricasRendimiento.puntualidad"></div>
                        </div>
                    </div>
                    
                    <div class="metrica-item">
                        <div class="metrica-valor">{{ metricasRendimiento.satisfaccionPacientes }}%</div>
                        <div class="metrica-label">Satisfacción</div>
                        <div class="metrica-barra">
                            <div class="barra-progreso" [style.width.%]="metricasRendimiento.satisfaccionPacientes"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="columna-derecha">
            
            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-user-friends"></i> Pacientes Recientes</h3>
                    <button (click)="verTodosLosPacientes()" class="btn-ver-todas">
                        Ver todos <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="pacientes-lista">
                    @for (paciente of pacientesRecientes; track paciente.id) {
                    <div class="paciente-item">
                        <div class="paciente-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="paciente-info">
                            <div class="paciente-nombre">{{ paciente.nombre }}</div>
                            <div class="paciente-diagnostico">{{ paciente.diagnostico }}</div>
                            <div class="paciente-fecha">Última cita: {{ paciente.ultimaCita }}</div>
                        </div>
                        <div class="paciente-estado">
                            <span class="estado-badge" [class]="'estado-' + paciente.estado">
                                @switch (paciente.estado) {
                                    @case ('critico') { 
                                        <i class="fas fa-exclamation-triangle"></i> Crítico
                                    }
                                    @case ('seguimiento') { 
                                        <i class="fas fa-eye"></i> Seguimiento
                                    }
                                    @case ('control') { 
                                        <i class="fas fa-check-circle"></i> Control
                                    }
                                    @case ('nuevo') { 
                                        <i class="fas fa-star"></i> Nuevo
                                    }
                                }
                            </span>
                        </div>
                    </div>
                    }
                </div>
            </div>

            <div class="seccion-card">
                <div class="seccion-header">
                    <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                </div>
                
                <div class="actividades-lista">
                    @for (actividad of actividadesRecientes; track actividad.id) {
                    <div class="actividad-item">
                        <div class="actividad-icon" [class]="'tipo-' + actividad.tipo">
                            @switch (actividad.tipo) {
                                @case ('cita') { <i class="fas fa-calendar-check"></i> }
                                @case ('diagnostico') { <i class="fas fa-diagnoses"></i> }
                                @case ('tratamiento') { <i class="fas fa-pills"></i> }
                                @case ('nota') { <i class="fas fa-sticky-note"></i> }
                            }
                        </div>
                        <div class="actividad-info">
                            <div class="actividad-descripcion">{{ actividad.descripcion }}</div>
                            <div class="actividad-paciente">{{ actividad.paciente }}</div>
                            <div class="actividad-tiempo">{{ actividad.fecha }} • {{ actividad.hora }}</div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>